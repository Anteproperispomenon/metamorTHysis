# Compiling

## Creating the Library

To actually turn your specifications into a program for
converting between orthographies, you need to create a
`.hs` file that brings together your various specification
files. To see an example of how to do this, look into the
[example file](https://github.com/Anteproperispomenon/metamorTHysis-template/blob/main/src/Orthographies.hs)
from [metamorTHysis-template](https://github.com/Anteproperispomenon/metamorTHysis-template).

To actually (try and) compile your code, you just need to run
the command:

```bash
stack build
```

## Creating the Binaries

Once you've got your library working, you'll need to create
a program that makes use of your converter program. If you've
used the [metamorTHysis template](https://github.com/Anteproperispomenon/metamorTHysis-template),
it should already have two binaries (i.e. programs) up and working.

### Command Line Interface version

The command line interface (or "CLI") program is a simple program
you can call from the command line/terminal/shell/etc... that converts
files from one orthography to another. The code for this program is
generated by [metamorTHysis-cli](https://github.com/Anteproperispomenon/metamorTHysis-cli).
The default name for this version from the metamorTHysis template is
`<your-project-name>-cli`, but if you're using a default stack project,
it might be `<your-project-name>-exe`. Either way, you can change the
program name to something else by changing the name in `package.yaml`.
This program can then be run by using the following command:

```bash
stack run my-converter-cli -- --from orth1 --to orth2 --input my-file.txt
```

For more info on how to run this program, see [running](running.md).

### Server Version

The server version of the code is a bit more complicated to get working,
but can be more user-friendly. Note that this is meant to be a **local**
server, not one to run on the open web (at least, not yet). Once again,
if you've use the [metamorTHysis template](https://github.com/Anteproperispomenon/metamorTHysis-template),
there will already be a binary for this version filled out. However, this
program may require some more configuration. 

To run the server program, just use the following command:

```bash
stack run my-converter-server
```

The server version consists of a single server, but in practice has two
very different use cases

#### JSON Server

The first use case is meant for application developers who want to create
a simple application that allows users to convert between different orthographies,
without (necessarily) having to use file I/O.

This creates a simple server (at `localhost:8081` by default), that accepts POST
requests at `localhost:8081/convert`, and `localhost:8081/query`. These POST requests
use simple JSON input of the following form:

```json
{ "text"   : "text to convert"
, "input"  : "orth1"
, "output" : "orth2"
}
```

If you don't know what the possible options are for `input` and `output`, you can also
send a GET request to `localhost:8081/info`, which will give a list of the possible
orthographies, along with the strings that will be interpreted as them in the `input`/`output`
fields, as well as a description of that orthography.

#### HTML/AJAX Server

The [metamorTHysis template](https://github.com/Anteproperispomenon/metamorTHysis-template) also
provides a simple HTML server that can be accessed by users without having to use a separate
program. It can be accessed by going to `localhost:8081/interactive/convert.html`, which provides
a simple interface to using the JSON server. Note that the files in the `interactive` directory
are served from the `static` directory in your project.

Note that when compiling your program, GHC will automatically create certain files in the `static`
directory. At the moment, these files are `convert.html` and `run_convert.js`. Make sure you don't
place any files by those names in the `static` directory of your project. Also, by default, the
template provides a simple `CSS` file in `static` that will be used by the HTML server. If you don't
want to use a `CSS` file, look for the following line in `server/Server.hs`...

```haskell
makeMainHTMLCSS "convert.css" inputOrthNameMap outputOrthNameMap
```

...and change it to...

```haskell
makeMainHTML inputOrthNameMap outputOrthNameMap
```

Alternatively, if you want to use a different `CSS` file, you can just change the name
of the file in parentheses, e.g.

```haskell
makeMainHTMLCSS "my_style.css" inputOrthNameMap outputOrthNameMap
```

Note that the new `CSS` file must be present in the `static` directory.


